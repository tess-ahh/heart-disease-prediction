# -*- coding: utf-8 -*-
"""heart disease prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1fBLWr8H6qYYPaeFmB5n42eGb6dwfHENE
"""

import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, confusion_matrix, classification_report
from sklearn.preprocessing import LabelEncoder

# Upload and load dataset
#from google.colab import files
#uploaded = files.upload()

df = pd.read_csv("heart_disease_uci.csv")
df.head()

# Drop columns not useful for prediction
df = df.drop(["id", "dataset"], axis=1)
df.head()

# Convert categorical features to numeric using Label Encoding
le = LabelEncoder()
for col in df.select_dtypes(include=["object"]).columns:
    df[col] = df[col].astype(str)
    df[col] = le.fit_transform(df[col])

df.head()

# Fill missing numeric values with median
df = df.fillna(df.median(numeric_only=True))

X = df.drop("num", axis=1)
y = df["num"]

# Convert target into binary (0 = no disease, 1 = disease present)
y = (y > 0).astype(int)

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train, y_train)

y_pred = model.predict(X_test)
# ðŸ”® Predict for a Single Patient from Dataset
# Example: Take the first patient in the dataset
patient = X.iloc[19].values.reshape(1, -1)   # select row 0 and reshape
patient_df = pd.DataFrame(patient, columns=X.columns) # Convert to DataFrame with column names
prediction = model.predict(patient_df)

if prediction[0] == 1:
    print("ðŸš¨ Patient has heart disease")
else:
    print("âœ… Patient does NOT have heart disease")

print("Accuracy:", accuracy_score(y_test, y_pred))
print("\nConfusion Matrix:\n", confusion_matrix(y_test, y_pred))
print("\nClassification Report:\n", classification_report(y_test, y_pred))

import matplotlib.pyplot as plt

importances = pd.Series(model.feature_importances_, index=X.columns).sort_values(ascending=False)
print("\nFeature Importance:\n", importances)

# Plot feature importance
plt.figure(figsize=(10,6))
importances.plot(kind="bar")
plt.title("Feature Importance - Random Forest")
plt.show()